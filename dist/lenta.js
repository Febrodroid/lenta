define("lenta/image-loader",["jquery"],function(e){var t=new Array,n=!1,r=function(){var e=t.shift();if(e){n=!0;var i=e.image.data("src");e.image.on("load",function(){e.def.resolve(e.image),r()}).on("error",function(){e.def.reject(e.image),r()}).attr("src",i)}else n=!1},i=function(n){var r=e.Deferred();return t.push({def:r,image:e(n)}),r.promise()};return{load:function(e){var t=i(e);return n||r(),t}}}),define("lenta/mixins/data-options",[],function(){return{optionsPrefix:"lenta",parseOptions:function(){var e=this,t=this.$el.data()||{},n=new RegExp("^"+this.optionsPrefix+"([a-zA-Z]+)");return $.each(t,function(r,i){t.hasOwnProperty(r)&&n.test(r)&&(shortName=r.match(n)[1].replace(/[A-Z]/,function(e){return(e||"").toLowerCase()}),e.options[shortName]=i)}),this}}}),define("lenta/slide",["backbone","lenta/image-loader","lenta/mixins/data-options"],function(e,t,n){var r=e.View.extend({options:{width:0,height:0},initialize:function(){this.parseOptions()},getOffset:function(){var e={x:this.$el.outerWidth(!0)-this.$el.width(),y:this.$el.outerHeight(!0)-this.$el.height()};return e},getAspectRatio:function(){return this.options.width/this.options.height},getOuterWidth:function(){return this.$el.outerWidth(!0)},getPosition:function(){return this.$el.position()},render:function(){var e=this;return this.$el.find("img").each(function(n,r){e.$el.addClass("loading"),t.load(r).then(function(t){e.$el.removeClass("loading")})}),this},resize:function(e){var t=this.getOffset();return e-=t.y,this.$el.css({height:e,width:Math.floor(e*this.getAspectRatio())}),this}});return _.extend(r.prototype,n),r}),define("lenta",["backbone","lenta/slide","lenta/mixins/data-options"],function(e,t,n){var r=e.View.extend({timerMoveOnResize:null,options:{height:0,sliderSelector:"> ul",slidesSelector:"> ul > li",prevBtnSelector:".lenta-prev",nextBtnSelector:".lenta-next",transitionSpeed:"fast",index:0,onMovingCssClass:"moving",onFocusCssClass:"focus"},initialize:function(){_.bindAll(this),this.parseOptions(),this.slider=this.$(this.options.sliderSelector),this.prevBtn=this.$(this.options.prevBtnSelector),this.nextBtn=this.$(this.options.nextBtnSelector),this.nextBtn.on("click",this.next),this.prevBtn.on("click",this.prev),this.$(this.options.slidesSelector).on("click",this.toSlide),this.on("moving",this.initControls),$(window).resize(this.onWindowResize)},onWindowResize:function(){var e=this;this.resize(),this.timerMoveOnResize&&(clearTimeout(this.timerMoveOnResize),this.timerMoveOnResize=null),this.timerMoveOnResize=setTimeout(function(){e.move(e.options.index)},300)},initControls:function(){this.options.index+1>=this.slides.length?this.nextBtn.hide():this.nextBtn.show(),this.options.index-1<0?this.prevBtn.hide():this.prevBtn.show()},toSlide:function(e){e.preventDefault();var t=this.$el.find(this.options.slidesSelector).index(e.currentTarget);t+1<=this.slides.length&&t>=0&&this.move(this.options.index=t)},prev:function(e){e.preventDefault(),this.options.index-1>=0&&this.move(--this.options.index)},next:function(e){e.preventDefault(),this.options.index+1<this.slides.length&&this.move(++this.options.index)},move:function(e){var t=this;if(this.$el.hasClass(this.options.onMovingCssClass))return!1;this.trigger("moving");var n=this.slides[e];if(n){var r=this.$el.width()/2-(n.getOuterWidth()/2+n.getPosition().left),i=0,s=this.$el.width()-this.slider.width();this.$el.addClass(this.options.onMovingCssClass),this.slider.animate({left:Math.max(Math.min(i,r),s>0?0:s)},this.options.transitionSpeed,function(){t.$el.removeClass(t.options.onMovingCssClass),t.setFocus(n),t.trigger("moved")})}},setFocus:function(e){this.$el.find(this.options.slidesSelector).removeClass(this.options.onFocusCssClass),e.$el.addClass(this.options.onFocusCssClass)},resize:function(){var e=this,t=0;return _.invoke(this.slides,function(){this.resize(e.$el.height()),t+=this.getOuterWidth()}),this.slider.width(t),this},render:function(){return this.$el.css({position:"relative","max-height":this.options.height}),this.slides=this.$(this.options.slidesSelector).map(function(e,n){return(new t({el:$(n)})).render()}),this.resize().move(this.options.index),this.$el.removeClass("loading"),this}});return _.extend(r.prototype,n),r});