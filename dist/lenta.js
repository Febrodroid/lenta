define("lenta/mixins/data-options",[],function(){return{optionsPrefix:"lenta",parseOptions:function(){var e=this,t=this.$el.data()||{},n=new RegExp("^"+this.optionsPrefix+"([a-zA-Z]+)");return $.each(t,function(r,i){t.hasOwnProperty(r)&&n.test(r)&&(shortName=r.match(n)[1].replace(/[A-Z]/,function(e){return(e||"").toLowerCase()}),e.options[shortName]=i)}),this}}}),define("lenta/slide",["backbone","lenta/mixins/data-options"],function(e,t){var n=e.View.extend({options:{width:0,height:0,maxWidth:null},initialize:function(){this.parseOptions()},isNearTo:function(){return!1},getOffset:function(){var e={x:this.$el.outerWidth(!0)-this.$el.width(),y:this.$el.outerHeight(!0)-this.$el.height()};return e},getAspectRatio:function(){var e=this.options.aspectRatio;return e||(e=this.options.width/this.options.height),e},getOuterWidth:function(){return this.$el.outerWidth(!0)},getPosition:function(){return this.$el.position()},resize:function(e){var t=this.getOffset();e-=t.y;var n=Math.floor(e*this.getAspectRatio());return this.options.maxWidth&&this.options.maxWidth<n&&(n=this.options.maxWidth),this.$el.css({height:e,width:n}),this}});return _.extend(n.prototype,t),n}),define("lenta/scrollbar",["backbone","lenta/mixins/data-options"],function(e,t){var n=e.View.extend({slider:null,viewport:null,lenta:null,handler:null,options:{handlerSelector:".lenta-scrollbar-handler"},initialize:function(){_.bindAll(this),this.lenta=this.options.lenta,this.slider=this.lenta.slider,this.viewport=this.lenta.viewport,this.handler=this.$(this.options.handlerSelector),this.lenta.on("moved",this.changePosition).on("resized",this.render),this.handler.draggable({axis:"x",containment:"parent",start:this.activateAllSlides,drag:this.changeContainerPosition,stop:this.toCenterSlide})},activateAllSlides:function(){this.lenta.activateAllSlides()},findCenterSlide:function(){var e={slide:null,offset:null},t=this.viewport.width()/2+Math.abs(parseInt(this.slider.css("left")));return _.each(this.lenta.slides,function(n){var r=Math.abs(t-n.getPosition().left);if(r<e.offset||e.offset==null)e.offset=r,e.slide=n}),e.slide},changePosition:function(){var e=parseInt(this.slider.css("left")),t=e/this.viewport.width()*this.handler.width();this.handler.css("left",-1*t)},changeContainerPosition:function(){var e=parseInt(this.handler.css("left")),t=e/this.handler.width()*this.viewport.width();this.slider.css("left",-1*t)},toCenterSlide:function(){var e=this.findCenterSlide();this.lenta.toSlide(e.$el)},render:function(){var e=this.viewport.width()/this.slider.width()*this.$el.width();return this.handler.width(e),this.slider.width()<=this.viewport.width()?this.$el.hide():this.$el.show(),this}});return n}),define("lenta",["backbone","lenta/slide","lenta/scrollbar","lenta/mixins/data-options","draggable"],function(e,t,n,r){var i=e.View.extend({timerMoveOnResize:null,options:{height:0,scrollbarSelector:".lenta-scrollbar",viewportSelector:".lenta-viewport",sliderSelector:".lenta-viewport > ul",slidesSelector:".lenta-viewport > ul > li",prevBtnSelector:".lenta-prev",nextBtnSelector:".lenta-next",transitionSpeed:"fast",index:0,onMovingCssClass:"moving",onFocusCssClass:"focus",aspectRatio:null,align:"left",verticalAlign:"top"},initialize:function(){_.bindAll(this),this.parseOptions(),this.scrollbar=null,this.slider=this.$(this.options.sliderSelector),this.prevBtn=this.$(this.options.prevBtnSelector),this.nextBtn=this.$(this.options.nextBtnSelector),this.viewport=this.$(this.options.viewportSelector),this.nextBtn.on("click",this.next),this.prevBtn.on("click",this.prev),this.$(this.options.slidesSelector).on("click",this.onSlideClick),this.on("moving",this.initControls),$(window).resize(this.onWindowResize),this.$(this.options.scrollbarSelector).length&&(this.scrollbar=new n({el:this.$(this.options.scrollbarSelector),lenta:this}))},onWindowResize:function(){var e=this;this.resize(),this.timerMoveOnResize&&(clearTimeout(this.timerMoveOnResize),this.timerMoveOnResize=null),this.timerMoveOnResize=setTimeout(function(){e.move(e.options.index)},300)},initControls:function(){this.options.index+1>=this.slides.length?this.nextBtn.hide():this.nextBtn.show(),this.options.index-1<0?this.prevBtn.hide():this.prevBtn.show()},onSlideClick:function(e){var t=$(e.currentTarget),n=t.hasClass(this.options.onFocusCssClass);n||this.toSlide(t)},toSlide:function(e){var t=this.$el.find(this.options.slidesSelector).index(e);t+1<=this.slides.length&&t>=0&&this.move(this.options.index=t)},prev:function(e){e.preventDefault(),this.options.index-1>=0&&this.move(--this.options.index)},next:function(e){e.preventDefault(),this.options.index+1<this.slides.length&&this.move(++this.options.index)},move:function(e){var t=this;if(this.$el.hasClass(this.options.onMovingCssClass))return!1;this.trigger("moving");var n=this.slides[e];if(n){this.$el.addClass(this.options.onMovingCssClass);var r=this.$el.width()/2-(n.getOuterWidth()/2+n.getPosition().left),i=0,s=this.$el.width()-this.slider.width();this.slider.animate({left:Math.max(Math.min(i,r),s>0?0:s)},this.options.transitionSpeed,function(){t.$el.removeClass(t.options.onMovingCssClass),t.setFocus(n),t.trigger("moved")})}},activateAllSlides:function(){this.$el.find(this.options.slidesSelector).addClass(this.options.onFocusCssClass)},deactivateAllSlides:function(){this.$el.find(this.options.slidesSelector).removeClass(this.options.onFocusCssClass)},setFocus:function(e){this.deactivateAllSlides(),e.$el.addClass(this.options.onFocusCssClass)},resize:function(){var e=this;if(this.options.aspectRatio){var t=this.$el.parent(),n=Math.min(t.width()/this.$el.width(),t.height()/this.$el.height()),r=this.$el.height()*n;r>this.options.height&&(r=this.options.height),this.$el.width(r*this.options.aspectRatio).height(r)}var i=0;return _.invoke(this.slides,function(){this.resize(e.$el.height(),e.$el.width()),i+=this.getOuterWidth()}),this.slider.width(i),this.align(),this.trigger("resized"),this},align:function(){if(this.options.align=="center"){var e=this.$el.parent().width()/2-this.$el.width()/2;this.$el.css("left",e)}else if(this.options.align=="right"){var e=this.$el.parent().width()-this.$el.width();this.$el.css("left",e)}if(this.options.verticalAlign=="center"){var t=this.$el.parent().height()/2-this.$el.height()/2;this.$el.css("top",t)}else if(this.options.verticalAlign=="bottom"){var t=this.$el.parent().height()-this.$el.height();this.$el.css("top",t)}},render:function(){return this.$el.css({position:"relative","max-height":this.options.height}),this.slides=this.$(this.options.slidesSelector).map(function(e,n){return(new t({el:$(n)})).render()}),this.resize().move(this.options.index),this.$el.removeClass("loading"),this}});return _.extend(i.prototype,r),i});